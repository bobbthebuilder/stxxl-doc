# This -*- Makefile -*- is intended for processing with nmake.

# Change this file according to your paths.

# change this path, do not leave spaces at the end of the line 
STXXL_ROOT = c:\anbe#
BOOST_ROOT = c:\boost#

MAKE = nmake
COMPILER = cl
LINKER = link
OPT = /O2
WARNINGS =
DEBUG = /MD # debug is off
# DEBUG = /MDd /Zi # debug is on

LIBNAME = stxxl


#### TROUBLESHOOTING
#
# For automatical checking of order of the output elements in
# the sorters: stxxl::stream::sort, stxxl::stream::merge_runs,
# stxxl::sort, and stxxl::ksort add
#
#     -DSTXXL_CHECK_ORDER_IN_SORTS
#
# to the compile options.
#
# FIXME: documentation needed
#
#STXXL_SPECIFIC += -DSTXXL_DEBUGMON


#### You usually shouldn't need to change the sections below #####


#### STXXL OPTIONS ###############################################

STXXL_SPECIFIC	 = \
	-DSORT_OPT_PREFETCHING \
	-DUSE_MALLOC_LOCK \
	-DCOUNT_WAIT_TIME \
	-I$(STXXL_ROOT)/ \
	-D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -D_LARGEFILE64_SOURCE

##################################################################


#### MICROSOFT VC OPTIONS ########################################

MSVC_COMPILER_OPTIONS = /EHsc /EHs /wd4820 /wd4217 /wd4668 /wd4619 \
 /wd4625 /wd4626 /wd4355 /wd4996 -D_SCL_SECURE_NO_DEPRECATE
MSVC_LINKER_OPTIONS = /LIBPATH:$(STXXL_ROOT)\lib\ \
 /LIBPATH:$(BOOST_ROOT)\lib\ 

##################################################################


#### BOOST OPTIONS ###############################################

BOOST_COMPILER_OPTIONS	 = \
	-D_RTLDLL \
	-DBOOST_LIB_DIAGNOSTIC \
	-DSTXXL_BOOST_TIMESTAMP \
	-DSTXXL_BOOST_CONFIG \
	-DSTXXL_BOOST_FILESYSTEM \
	-DSTXXL_BOOST_THREADS \
	-DSTXXL_BOOST_RANDOM \
	-I$(BOOST_ROOT)

##################################################################


#### DEPENDENCIES ################################################

HEADER_PATH	 = ../stxxl/bits

COMMON_FILES	 = \
	$(HEADER_PATH)/namespace.h \
	$(HEADER_PATH)/common/aligned_alloc.h \
	$(HEADER_PATH)/common/mutex.h \
	$(HEADER_PATH)/common/rand.h \
	$(HEADER_PATH)/common/semaphore.h \
	$(HEADER_PATH)/common/state.h \
	$(HEADER_PATH)/common/timer.h \
	$(HEADER_PATH)/common/utils.h \
	$(HEADER_PATH)/common/gprof.h \
	$(HEADER_PATH)/common/rwlock.h \
	$(HEADER_PATH)/common/simple_vector.h \
	$(HEADER_PATH)/common/switch.h \
	$(HEADER_PATH)/common/tmeta.h \
	$(HEADER_PATH)/common/log.h \
	$(HEADER_PATH)/common/exceptions.h \
	$(HEADER_PATH)/common/debug.h \
	$(HEADER_PATH)/common/tuple.h \
	$(HEADER_PATH)/common/types.h \
	../make.settings

IO_LAYER_FILES	 = \
	$(HEADER_PATH)/io/completion_handler.h \
	$(HEADER_PATH)/io/io.h \
	$(HEADER_PATH)/io/iobase.h \
	$(HEADER_PATH)/io/iostats.h \
	$(HEADER_PATH)/io/mmap_file.h \
	$(HEADER_PATH)/io/simdisk_file.h \
	$(HEADER_PATH)/io/syscall_file.h \
	$(HEADER_PATH)/io/ufs_file.h \
	$(HEADER_PATH)/io/wincall_file.h \
	$(HEADER_PATH)/io/wfs_file.h \
	$(HEADER_PATH)/io/boostfd_file.h

MNG_LAYER_FILES	 = \
	$(HEADER_PATH)/mng/adaptor.h \
	$(HEADER_PATH)/mng/async_schedule.h \
	$(HEADER_PATH)/mng/block_prefetcher.h \
	$(HEADER_PATH)/mng/buf_istream.h \
	$(HEADER_PATH)/mng/buf_ostream.h \
	$(HEADER_PATH)/mng/buf_writer.h \
	$(HEADER_PATH)/mng/mng.h \
	$(HEADER_PATH)/mng/write_pool.h \
	$(HEADER_PATH)/mng/prefetch_pool.h

CONTAINER_FILES	 = \
	$(HEADER_PATH)/containers/pager.h \
	$(HEADER_PATH)/containers/stack.h \
	$(HEADER_PATH)/containers/vector.h \
	$(HEADER_PATH)/containers/priority_queue.h \
	$(HEADER_PATH)/containers/queue.h \
	$(HEADER_PATH)/containers/map.h \
	$(HEADER_PATH)/containers/deque.h \
	$(HEADER_PATH)/containers/btree/btree.h \
	$(HEADER_PATH)/containers/btree/iterator_map.h \
	$(HEADER_PATH)/containers/btree/leaf.h \
	$(HEADER_PATH)/containers/btree/node_cache.h \
	$(HEADER_PATH)/containers/btree/root_node.h \
	$(HEADER_PATH)/containers/btree/node.h \
	$(HEADER_PATH)/containers/btree/btree_pager.h \
	$(HEADER_PATH)/containers/btree/iterator.h

ALGO_FILES	 = \
	$(HEADER_PATH)/algo/adaptor.h \
	$(HEADER_PATH)/algo/inmemsort.h \
	$(HEADER_PATH)/algo/intksort.h \
	$(HEADER_PATH)/algo/run_cursor.h \
	$(HEADER_PATH)/algo/sort.h \
	$(HEADER_PATH)/algo/async_schedule.h \
	$(HEADER_PATH)/algo/interleaved_alloc.h \
	$(HEADER_PATH)/algo/ksort.h \
	$(HEADER_PATH)/algo/losertree.h \
	$(HEADER_PATH)/algo/scan.h \
	$(HEADER_PATH)/algo/stable_ksort.h \
	$(HEADER_PATH)/algo/random_shuffle.h

STREAM_FILES	 = \
	$(HEADER_PATH)/stream/stream.h \
	$(HEADER_PATH)/stream/sort_stream.h

###################################################################


#### MISC #########################################################

OBJEXT = obj # extension of object file
LIBEXT = lib # static library file extension
EXEEXT = exe # executable file extension
RM =     del # remove file command
LIBGEN = lib /out:# library generation
OUT    = /out:# output file for linking and compilation

###################################################################


STXXL_COMPILER_OPTIONS	 = \
	$(STXXL_SPECIFIC) \
	$(OPT) $(DEBUG) $(WARNINGS) \
	$(BOOST_COMPILER_OPTIONS) \
	$(MSVC_COMPILER_OPTIONS)

STXXL_LINKER_OPTIONS	 = \
	$(MSVC_LINKER_OPTIONS) \
	$(DEBUG)


# vim: syn=make
